/*!
 * FilePondPluginImageTransform 3.3.3
 * Licensed under MIT, https://opensource.org/licenses/MIT/
 * Please visit https://pqina.nl/filepond/ for details.
 */

/* eslint-disable */

!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).FilePondPluginImageTransform=e()}(this,function(){"use strict";var t={jpeg:"jpg","svg+xml":"svg"},e={1:function(){return[1,0,0,1,0,0]},2:function(t){return[-1,0,0,1,t,0]},3:function(t,e){return[-1,0,0,-1,t,e]},4:function(t,e){return[1,0,0,-1,0,e]},5:function(){return[0,1,1,0,0,0]},6:function(t,e){return[0,1,-1,0,e,0]},7:function(t,e){return[0,-1,-1,0,e,t]},8:function(t){return[0,-1,1,0,0,t]}},n=function(t,e){return{x:t,y:e}},i=function(t,e){return n(t.x-e.x,t.y-e.y)},r=function(t,e){return Math.sqrt(function(t,e){return function(t,e){return t.x*e.x+t.y*e.y}(i(t,e),i(t,e))}(t,e))},a=function(t,e){var i=t,r=e,a=1.5707963267948966-e,o=Math.sin(1.5707963267948966),u=Math.sin(r),c=Math.sin(a),l=Math.cos(a),h=i/o;return n(l*(h*u),l*(h*c))},o=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{x:.5,y:.5},u=o.x>.5?1-o.x:o.x,c=o.y>.5?1-o.y:o.y,l=2*u*t.width,h=2*c*t.height,f=function(t,e){var i=t.width,o=t.height,u=a(i,e),c=a(o,e),l=n(t.x+Math.abs(u.x),t.y-Math.abs(u.y)),h=n(t.x+t.width+Math.abs(c.y),t.y+Math.abs(c.x)),f=n(t.x-Math.abs(c.y),t.y+t.height-Math.abs(c.x));return{width:r(l,h),height:r(l,f)}}(e,i);return Math.max(f.width/l,f.height/h)},u=function(t,e){var n=t.width,i=n*e;return i>t.height&&(n=(i=t.height)/e),{x:.5*(t.width-n),y:.5*(t.height-i),width:n,height:i}},c=function(t){return t&&(t.horizontal||t.vertical)},l=function(t,n,i){if(!n&&!c(i))return t.width=t.naturalWidth,t.height=t.naturalHeight,t;var r=document.createElement("canvas"),a=t.naturalWidth,o=t.naturalHeight,u=n>=5&&n<=8;u?(r.width=o,r.height=a):(r.width=a,r.height=o);var l=r.getContext("2d");if(n&&l.transform.apply(l,function(t,n,i){return-1===i&&(i=1),e[i](t,n)}(a,o,n)),c(i)){var h=[1,0,0,1,0,0];(!u&&i.horizontal||u&i.vertical)&&(h[0]=-1,h[4]=a),(!u&&i.vertical||u&&i.horizontal)&&(h[3]=-1,h[5]=o),l.transform.apply(l,h)}return l.drawImage(t,0,0,a,o),r},h=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.zoom||1,r=l(t,e,n.flip),a={width:r.width,height:r.height},c=document.createElement("canvas"),h=n.aspectRatio||a.height/a.width,f=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=t.height/t.width,r=e,a=1,o=i;o>r&&(a=(o=r)/i);var u=Math.max(1/a,r/o),c=t.width/(n*u*a);return{width:c,height:c*e}}(a,h,i),s={x:.5*f.width,y:.5*f.height},d={x:0,y:0,width:f.width,height:f.height,center:s},g=i*o(a,u(d,h),n.rotation,n.center);c.width=Math.round(f.width/g),c.height=Math.round(f.height/g),s.x/=g,s.y/=g;var m=s.x-a.width*(n.center?n.center.x:.5),v=s.y-a.height*(n.center?n.center.y:.5),p=c.getContext("2d");return p.translate(s.x,s.y),p.rotate(n.rotation||0),p.drawImage(r,m-s.x,v-s.y,a.width,a.height),p.getImageData(0,0,c.width,c.height)};"undefined"!=typeof window&&void 0!==window.document&&(HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(t,e,n){var i=this.toDataURL(e,n).split(",")[1];setTimeout(function(){for(var n=atob(i),r=n.length,a=new Uint8Array(r),o=0;o<r;o++)a[o]=n.charCodeAt(o);t(new Blob([a],{type:e||"image/png"}))})}}));var f=function(){var t={resize:function(t,e){var i=e.mode,o=void 0===i?"contain":i,u=e.upscale,c=void 0!==u&&u,l=e.width,h=e.height,f=e.matrix;if(f=!f||r(f)?null:f,!l&&!h)return a(t,f);null===l?l=h:null===h&&(h=l);if("force"!==o){var s=l/t.width,d=h/t.height,g=1;if("cover"===o?g=Math.max(s,d):"contain"===o&&(g=Math.min(s,d)),g>1&&!1===c)return a(t,f);l=t.width*g,h=t.height*g}for(var m=t.width,v=t.height,p=Math.round(l),y=Math.round(h),w=t.data,M=new Uint8ClampedArray(p*y*4),T=m/p,x=v/y,A=Math.ceil(.5*T),b=Math.ceil(.5*x),R=0;R<y;R++)for(var E=0;E<p;E++){for(var _=4*(E+R*p),O=0,I=0,U=0,N=0,B=0,L=0,P=0,S=(R+.5)*x,G=Math.floor(R*x);G<(R+1)*x;G++)for(var F=Math.abs(S-(G+.5))/b,z=(E+.5)*T,C=F*F,j=Math.floor(E*T);j<(E+1)*T;j++){var D=Math.abs(z-(j+.5))/A,q=Math.sqrt(C+D*D);if(q>=-1&&q<=1&&(O=2*q*q*q-3*q*q+1)>0){var H=w[(D=4*(j+G*m))+3];P+=O*H,U+=O,H<255&&(O=O*H/250),N+=O*w[D],B+=O*w[D+1],L+=O*w[D+2],I+=O}}M[_]=N/I,M[_+1]=B/I,M[_+2]=L/I,M[_+3]=P/U,f&&n(_,M,f)}return{data:M,width:p,height:y}},filter:a},e=function(e,n){var i=e.transforms,r=null;if(i.forEach(function(t){"filter"===t.type&&(r=t)}),r){var a=null;i.forEach(function(t){"resize"===t.type&&(a=t)}),a&&(a.data.matrix=r.data,i=i.filter(function(t){return"filter"!==t.type}))}n(function(e,n){return e.forEach(function(e){n=t[e.type](n,e.data)}),n}(i,e.imageData))};function n(t,e,n){for(var i=0,r=0,a=0,o=e[t]/255,u=e[t+1]/255,c=e[t+2]/255,l=e[t+3]/255;i<4;i++)a=255*(o*n[r=5*i]+u*n[r+1]+c*n[r+2]+l*n[r+3]+n[r+4]),e[t+i]=Math.max(0,Math.min(a,255))}self.onmessage=function(t){e(t.data.message,function(e){self.postMessage({id:t.data.id,message:e},[e.data.buffer])})};var i=JSON.stringify([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]);function r(t){return JSON.stringify(t||[])===i}function a(t,e){if(!e||r(e))return t;for(var n=t.data,i=n.length,a=e[0],o=e[1],u=e[2],c=e[3],l=e[4],h=e[5],f=e[6],s=e[7],d=e[8],g=e[9],m=e[10],v=e[11],p=e[12],y=e[13],w=e[14],M=e[15],T=e[16],x=e[17],A=e[18],b=e[19],R=0,E=0,_=0,O=0,I=0;R<i;R+=4)E=n[R]/255,_=n[R+1]/255,O=n[R+2]/255,I=n[R+3]/255,n[R]=Math.max(0,Math.min(255*(E*a+_*o+O*u+I*c+l),255)),n[R+1]=Math.max(0,Math.min(255*(E*h+_*f+O*s+I*d+g),255)),n[R+2]=Math.max(0,Math.min(255*(E*m+_*v+O*p+I*y+w),255)),n[R+3]=Math.max(0,Math.min(255*(E*M+_*T+O*x+I*A+b),255));return t}},s=function(t,e,n){if(1165519206===t.getUint32(e+4,!1)){e+=4;var i=18761===t.getUint16(e+=6,!1);e+=t.getUint32(e+4,i);var r=t.getUint16(e,i);e+=2;for(var a=0;a<r;a++)if(274===t.getUint16(e+12*a,i))return t.setUint16(e+12*a+8,1,i),!0;return!1}},d=function(t){return new Promise(function(e,n){var i=new FileReader;i.onload=function(){return e(function(t){var e=new DataView(t);if(65496!==e.getUint16(0))return null;for(var n,i,r=2,a=!1;r<e.byteLength&&(n=e.getUint16(r,!1),i=e.getUint16(r+2,!1)+2,n>=65504&&n<=65519||65534===n)&&(a||(a=s(e,r)),!(r+i>e.byteLength));)r+=i;return t.slice(0,r)}(i.result)||null)},i.readAsArrayBuffer(t.slice(0,262144))})},g=function(t,e){var n=window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if(n){var i=new n;return i.append(t),i.getBlob(e)}return new Blob([t],{type:e})},m=function(t){var e=new Blob(["(",t.toString(),")()"],{type:"application/javascript"}),n=URL.createObjectURL(e),i=new Worker(n);return{transfer:function(t,e){},post:function(t,e,n){var r=Math.random().toString(36).substr(2,9);i.onmessage=function(t){t.data.id===r&&e(t.data.message)},i.postMessage({id:r,message:t},n)},terminate:function(){i.terminate(),URL.revokeObjectURL(n)}}},v=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new Promise(function(i,r){if(!t||!function(t){return/^image/.test(t.type)}(t))return r();var a=n.stripImageHead,c=n.beforeCreateBlob,l=n.afterCreateBlob,s=e.crop,v=e.size,p=e.filter,y=e.output,w=e.image&&e.image.orientation?Math.max(1,Math.min(8,e.image.orientation)):null,M=y&&y.quality,T=null===M?null:M/100,x=y&&y.type||null,A=[];!v||"number"!=typeof v.width&&"number"!=typeof v.height||A.push({type:"resize",data:v}),p&&20===p.length&&A.push({type:"filter",data:p});var b=function(t){var e=l?l(t):t;Promise.resolve(e).then(i)},R=function(e,n){return function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return new Promise(function(i){var r=document.createElement("canvas");r.width=t.width,r.height=t.height,r.getContext("2d").putImageData(t,0,0);var a=n?n(r):r;Promise.resolve(a).then(function(t){t.toBlob(i,e.type,e.quality)})})}(e,n,c).then(function(e){if(a)return b(e);d(t).then(function(t){null!==t&&(e=new Blob([t,e.slice(20)],{type:e.type})),b(e)})}).catch(r)};if(/svg/.test(t.type)&&null===x)return function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{center:{x:.5,y:.5},zoom:1,rotation:0,flip:{horizontal:!1,vertical:!1,aspectRatio:null}};return new Promise(function(n){var i=new FileReader;i.onloadend=function(){var t=i.result,r=document.createElement("div");r.style.cssText="position:absolute;pointer-events:none;width:0;height:0;visibility:hidden;",r.innerHTML=t;var a=r.querySelector("svg");document.body.appendChild(r);var c=a.getBBox();r.parentNode.removeChild(r);var l=r.querySelector("title"),h=a.getAttribute("viewBox")||"",f=a.getAttribute("width")||"",s=a.getAttribute("height")||"",d=parseFloat(f)||null,g=parseFloat(s)||null,m=(f.match(/[a-z]+/)||[])[0]||"",v=(s.match(/[a-z]+/)||[])[0]||"",p=h.split(" ").map(parseFloat),y=p.length?{x:p[0],y:p[1],width:p[2],height:p[3]}:c,w=null!=d?d:y.width,M=null!=g?g:y.height;a.style.overflow="visible",a.setAttribute("width",w),a.setAttribute("height",M);var T=e.aspectRatio||M/w,x=w,A=x*T,b=o({width:w,height:M},u({width:x,height:A},T),e.rotation,e.center),R=e.zoom*b,E=e.rotation*(180/Math.PI),_={x:.5*x,y:.5*A},O={x:_.x-w*e.center.x,y:_.y-M*e.center.y},I=["rotate(".concat(E," ").concat(_.x," ").concat(_.y,")"),"translate(".concat(_.x," ").concat(_.y,")"),"scale(".concat(R,")"),"translate(".concat(-_.x," ").concat(-_.y,")"),"translate(".concat(O.x," ").concat(O.y,")")],U=["scale(".concat(e.flip.horizontal?-1:1," ").concat(e.flip.vertical?-1:1,")"),"translate(".concat(e.flip.horizontal?-w:0," ").concat(e.flip.vertical?-M:0,")")],N='<?xml version="1.0" encoding="UTF-8"?>\n<svg width="'.concat(x).concat(m,'" height="').concat(A).concat(v,'" \nviewBox="0 0 ').concat(x," ").concat(A,'" \npreserveAspectRatio="xMinYMin"\nxmlns="http://www.w3.org/2000/svg">\n\x3c!-- Generator: PQINA - https://pqina.nl/ --\x3e\n<title>').concat(l?l.textContent:"",'</title>\n<desc>Cropped with FilePond.</desc>\n<g transform="').concat(I.join(" "),'">\n<g transform="').concat(U.join(" "),'">\n').concat(a.outerHTML,"\n</g>\n</g>\n</svg>");n(N)},i.readAsText(t)})}(t,s).then(function(t){i(g(t,"image/svg+xml"))});var E=URL.createObjectURL(t);(function(t){return new Promise(function(e,n){var i=new Image;i.onload=function(){e(i)},i.onerror=function(t){n(t)},i.src=t})})(E).then(function(e){URL.revokeObjectURL(E);var n=h(e,w,s),i={quality:T,type:x||t.type};if(!A.length)return R(n,i);var r=m(f);r.post({transforms:A,imageData:n},function(t){R(function(t){var e;try{e=new ImageData(t.width,t.height)}catch(n){e=document.createElement("canvas").getContext("2d").createImageData(t.width,t.height)}return e.data.set(t.data),e}(t),i),r.terminate()},[n.data.buffer])})})};"undefined"!=typeof window&&void 0!==window.document&&(HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(t,e,n){var i=this;setTimeout(function(){for(var r=i.toDataURL(e,n).split(",")[1],a=atob(r),o=a.length,u=new Uint8Array(o);o--;)u[o]=a.charCodeAt(o);t(new Blob([u],{type:e||"image/png"}))})}}));var p=function(e){var n=e.addFilter,i=e.utils,r=i.Type,a=i.forin,o=i.getFileFromBlob,u=i.isFile,c=["crop","resize","filter","output"],l=function(t){return null===t.aspectRatio&&0===t.rotation&&1===t.zoom&&t.center&&.5===t.center.x&&.5===t.center.y&&t.flip&&!1===t.flip.horizontal&&!1===t.flip.vertical};return n("SHOULD_PREPARE_OUTPUT",function(t,e){var n=e.query;return new Promise(function(t){t(!n("IS_ASYNC"))})}),n("PREPARE_OUTPUT",function(e,n){var i=n.query,r=n.item;return new Promise(function(n){if(!u(e)||!function(t){return/^image/.test(t.type)}(e)||!i("GET_ALLOW_IMAGE_TRANSFORM")||r.archived)return n(e);var h=[];i("GET_IMAGE_TRANSFORM_VARIANTS_INCLUDE_ORIGINAL")&&h.push(function(){return new Promise(function(t){t({name:i("GET_IMAGE_TRANSFORM_VARIANTS_ORIGINAL_NAME"),file:e})})}),i("GET_IMAGE_TRANSFORM_VARIANTS_INCLUDE_DEFAULT")&&h.push(function(t,e,n){return new Promise(function(r){t(e,n).then(function(t){return r({name:i("GET_IMAGE_TRANSFORM_VARIANTS_DEFAULT_NAME"),file:t})})})});var f=i("GET_IMAGE_TRANSFORM_VARIANTS")||{};a(f,function(t,e){var n,i=(n=e,function(t,e,i){return t(e,n?n(i):i)});h.push(function(e,n,r){return new Promise(function(a){i(e,n,r).then(function(e){return a({name:t,file:e})})})})});var s=i("GET_IMAGE_TRANSFORM_OUTPUT_QUALITY"),d=i("GET_IMAGE_TRANSFORM_OUTPUT_QUALITY_MODE"),g=null===s?null:s/100,m=i("GET_IMAGE_TRANSFORM_OUTPUT_MIME_TYPE"),p=i("GET_IMAGE_TRANSFORM_CLIENT_TRANSFORMS")||c;r.setMetadata("output",{type:m,quality:g,client:p},!0);var y=function(e,n){return new Promise(function(r,a){var u=Object.assign({},n);Object.keys(u).filter(function(t){return"exif"!==t}).forEach(function(t){-1===p.indexOf(t)&&delete u[t]});var c=u.resize,h=u.exif,f=u.output,s=u.crop,g=u.filter,m={image:{orientation:h?h.orientation:null},output:f?{type:f.type,quality:f.quality?100*f.quality:null}:void 0,size:c&&(c.size.width||c.size.height)?Object.assign({mode:c.mode,upscale:c.upscale},c.size):void 0,crop:s&&!l(s)?Object.assign({},s):void 0,filter:g};if(m.output){var y=f.type&&f.type!==e.type,w=!!(m.size||m.crop||m.filter||y);if(f.quality&&"optional"===d&&!w)return r(e)}var M={stripImageHead:i("GET_IMAGE_TRANSFORM_OUTPUT_STRIP_IMAGE_HEAD")};v(e,m,M).then(function(n){var i,a=o(n,function(e,n){var i=function(t){return t.substr(0,t.lastIndexOf("."))||t}(e),r=n.split("/")[1],a=t[r]||r;return"".concat(i,".").concat(a)}(e.name,(i=n.type,/jpeg|png|svg\+xml/.test(i)?i:"image/jpeg")));r(a)}).catch(a)})},w=h.map(function(t){return t(y,e,r.getMetadata())});Promise.all(w).then(function(t){n(1===t.length&&null===t[0].name?t[0].file:t)})})}),{options:{allowImageTransform:[!0,r.BOOLEAN],imageTransformOutputMimeType:[null,r.STRING],imageTransformOutputQuality:[null,r.INT],imageTransformOutputStripImageHead:[!0,r.BOOLEAN],imageTransformClientTransforms:[null,r.ARRAY],imageTransformOutputQualityMode:["always",r.STRING],imageTransformVariants:[null,r.OBJECT],imageTransformVariantsIncludeDefault:[!0,r.BOOLEAN],imageTransformVariantsDefaultName:[null,r.STRING],imageTransformVariantsIncludeOriginal:[!1,r.BOOLEAN],imageTransformVariantsOriginalName:["original_",r.STRING]}}};return"undefined"!=typeof window&&void 0!==window.document&&document.dispatchEvent(new CustomEvent("FilePond:pluginloaded",{detail:p})),p});
